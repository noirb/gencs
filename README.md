# GenCS
A C# code generator to produce classes compatible with the Unity ROSBridge used by [SIGVerse 3](https://github.com/SIGVerse/sigverse_unity_project) and [onto_agent's training environment](https://github.com/noirb/HouseholdScenarios) based on ROS message definitions.

## Dependencies
**NOTE:** If you have ROS installed, you already have these. They are only listed here for completeness on the off chance that someone wants to try to use this *without* ROS.

* [genmsg](http://wiki.ros.org/genmsg)
* [catkin](http://wiki.ros.org/catkin)
* [empy](https://pypi.python.org/pypi/EmPy/3.2)

## Setup (with ROS)
*These steps assume you already have a working ROS installation and have already set up a catkin workspace for your project.*

The short version:
1. Clone this project into your catkin workspace
2. Run `catkin_make` from your workspace root and ensure there are no errors from the new project.
3. `source devel/setup.bash`
4. Now any time you `catkin_make` your message-containing projects, you will also generate C# versions of all messages.

The long version:
1. Clone this project into your catkin workspace. Make sure the gencs folder is in your workspace's src folder (e.g. `~/catkin_ws/src/gencs`).
2. Run 'catkin_make' from your workspace root and ensure there are no errors from the new project.
3. Run the command 'source devel/setup.bash' from your catkin workspace folder. You need to do this to configure your workspace to use the new generator.
4. If you already have an existing, compiling, ROS package you want to generate messages for, skip to step 7. If not go on with step 5 to create a new package.
5. Create your package, which contains the messages and services to be converted to C#. Remember to put messages in the `msg` folder and services in the `srv` folder of your package (e.g. `~/catkin_ws/src/my_package/msg/`).
6. Make sure your package's CMakeLists.txt file has the correct dependencies:
	- `find_package` needs the `message_generation` dependency and should probably also include the `std_msgs` dependency
	- `add_message_files` and `add_service_files` should list all the messages and services that you want converted
	- `generate_messages` should also include the `std_msgs` dependency
7. Run 'catkin_make' again.
8. Now the C# files should be available in your workspace under `<include_dir>/csharp/<package_name>`.

## Usage (with Unity)
Once setup, any time you rebuild your messages you should also get C# versions of them (in addition to whatever other languages you're working in). They will be located under `<include_dir>/csharp/<package>/`

For a default workspace configuration this will usually mean they're under `~/catkin_ws/devel/include/csharp/<package>`

They are placed under the `csharp` directory to separate them from other messages, since they aren't intended to be used as-is with ROS directly.

Once you've generated your messages, copy the contents of the `csharp` directory into the `Assets` folder of your Unity project, and you should be good to go!

## Notes

The messages generated by this project are intended for use with the ROSBridgeLib provided with [Sigverse 3](http://github.com/SIGVerse/sigverse_unity_project). This results in a few assumptions by the generator which may cause you problems if you want to use the generated classes without the ROSBridgeLib or outside of a Unity project.

If you only intend to use these classes with Sigverse 3 in Unity, you shouldn't need to worry about any of the points below.

* All generated messages are placed inside the `ROSBridgeLib` namespace.
* The `Time` data type [as defined by ROS](http://wiki.ros.org/roscpp/Overview/Time) does not exist in C#, so the ROSBridgeLib provides its own implementation.
* By default, the generator will replace some common message types with Unity messages (e.g. `geometry_msgs/Point` --> `UnityEngine.Vector3`). This is convenient because they happen to serialize to the same output and the message content can be used directly with Unity objects without any need for conversion. This can be disabled by setting `USE_UNITY_TYPES` to `False` in [\_\_init__.py](./src/gencs/__init__.py).
* The generated messages all inherit from a base ROSMessage class provided by ROSBridgeLib.

